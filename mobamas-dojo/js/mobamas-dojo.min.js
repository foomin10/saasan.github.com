"use strict";!function(){function a(a){return["$rootScope","$window",function(b,c){for(var d,e,f,g=c[a]||(console.warn("This browser does not support Web Storage!"),{}),h={$default:function(a){for(var b in a)angular.isDefined(h[b])||(h[b]=a[b]);return h},$reset:function(a){for(var b in h)"$"===b[0]||delete h[b];return h.$default(a)}},i=0;i<g.length;i++)(f=g.key(i))&&"ngStorage-"===f.slice(0,10)&&(h[f.slice(10)]=angular.fromJson(g.getItem(f)));return d=angular.copy(h),b.$watch(function(){e||(e=setTimeout(function(){if(e=null,!angular.equals(h,d)){angular.forEach(h,function(a,b){angular.isDefined(a)&&"$"!==b[0]&&g.setItem("ngStorage-"+b,angular.toJson(a)),delete d[b]});for(var a in d)g.removeItem("ngStorage-"+a);d=angular.copy(h)}},100))}),"localStorage"===a&&c.addEventListener&&c.addEventListener("storage",function(a){"ngStorage-"===a.key.slice(0,10)&&(a.newValue?h[a.key.slice(10)]=angular.fromJson(a.newValue):delete h[a.key.slice(10)],d=angular.copy(h),b.$apply())}),h}]}angular.module("ngStorage",[]).factory("$localStorage",a("localStorage")).factory("$sessionStorage",a("sessionStorage"))}();var Birthday;!function(){Birthday=function(){for(var a=1;12>=a;a++)this._data[a]=[];this._data[1][1]="道明寺歌鈴、鷹富士茄子",this._data[1][3]="野々村そら、村上巴",this._data[1][6]="三村かな子、安斎都",this._data[1][10]="瀬名詩織",this._data[1][13]="浜口あやめ",this._data[1][19]="メアリー・コクラン",this._data[1][21]="福山舞、松山久美子、四条貴音",this._data[1][23]="西園寺琴歌",this._data[1][28]="太田優",this._data[2][3]="二宮飛鳥",this._data[2][6]="江上椿",this._data[2][7]="東郷あい",this._data[2][8]="市原仁奈",this._data[2][11]="浅野風香",this._data[2][14]="相原雪乃、宮本フレデリカ",this._data[2][17]="北川真尋",this._data[2][19]="遊佐こずえ",this._data[2][22]="前川みく",this._data[2][24]="桐生つかさ",this._data[2][25]="三船美優、如月千早",this._data[2][26]="黒川千秋",this._data[3][3]="今井加奈",this._data[3][5]="小関麗奈",this._data[3][6]="有浦柑奈",this._data[3][7]="片桐早苗",this._data[3][9]="工藤忍",this._data[3][10]="ルーキートレーナー",this._data[3][13]="堀裕子",this._data[3][16]="柳瀬美由紀",this._data[3][18]="衛藤美紗希",this._data[3][19]="長富蓮実",this._data[3][20]="大西由里子",this._data[3][21]="松尾千鶴",this._data[3][23]="中野有香",this._data[3][25]="高峯のあ、高槻やよい",this._data[3][27]="村松さくら",this._data[3][28]="白坂小梅",this._data[3][30]="大沼くるみ",this._data[4][1]="古賀小春",this._data[4][3]="天海春香",this._data[4][4]="ヘレン",this._data[4][6]="喜多日菜子",this._data[4][7]="和久井留美",this._data[4][8]="神崎蘭子、櫻井桃華、桐野アヤ",this._data[4][9]="荒木比奈",this._data[4][10]="上条春菜",this._data[4][12]="大原みちる",this._data[4][14]="赤城みりあ",this._data[4][15]="相葉夕美",this._data[4][18]="財前時子",this._data[4][19]="白菊ほたる",this._data[4][24]="島村卯月",this._data[4][27]="槙原志保、水木聖來",this._data[5][1]="難波笑美",this._data[5][2]="土屋亜子",this._data[5][4]="日下部若葉",this._data[5][5]="水瀬伊織",this._data[5][6]="沢田麻理菜",this._data[5][7]="大槻唯",this._data[5][8]="高橋礼子、吉岡沙紀",this._data[5][9]="早坂美玲",this._data[5][12]="柳清良",this._data[5][15]="安部菜々",this._data[5][18]="古澤頼子",this._data[5][21]="ライラ",this._data[5][22]="双海亜美、双海真美",this._data[5][25]="浜川愛結奈",this._data[5][29]="綾瀬穂乃香",this._data[5][30]="一ノ瀬志希",this._data[6][3]="及川雫",this._data[6][4]="丹羽仁美",this._data[6][6]="星輝子",this._data[6][7]="佐々木千枝",this._data[6][9]="小室千奈美",this._data[6][10]="池袋晶葉、トレーナー",this._data[6][11]="緒方智絵里",this._data[6][12]="奥山沙織",this._data[6][14]="高垣楓",this._data[6][15]="藤原肇",this._data[6][20]="梅木音葉",this._data[6][23]="秋月律子",this._data[6][25]="三好紗南",this._data[6][27]="仙崎恵磨",this._data[6][29]="ナターリア",this._data[6][30]="多田李衣菜",this._data[7][1]="速水奏、藤居朋",this._data[7][3]="依田芳乃",this._data[7][7]="桃井あずき、赤西瑛梨華",this._data[7][10]="矢口美羽",this._data[7][13]="氏家むつみ",this._data[7][16]="岡崎泰葉",this._data[7][17]="結城晴",this._data[7][19]="三浦あずさ",this._data[7][20]="杉坂海、龍崎薫",this._data[7][22]="佐藤心",this._data[7][23]="相馬夏美",this._data[7][25]="高森藍子",this._data[7][27]="新田美波",this._data[7][30]="城ヶ崎莉嘉",this._data[7][31]="橘ありす",this._data[8][1]="愛野渚、棟方愛海",this._data[8][3]="海老原菜帆",this._data[8][4]="日野茜",this._data[8][7]="向井拓海",this._data[8][8]="木場真奈美",this._data[8][10]="渋谷凛、五十嵐響子",this._data[8][15]="ケイト",this._data[8][17]="関裕美、西島櫂",this._data[8][18]="首藤葵",this._data[8][19]="木村夏樹",this._data[8][24]="持田亜里沙",this._data[8][26]="クラリス",this._data[8][27]="井村雪菜、榊原里美、森久保乃々",this._data[8][28]="涼宮星花",this._data[8][29]="菊地真",this._data[8][30]="若林智香",this._data[9][1]="諸星きらり、松本沙理奈",this._data[9][2]="双葉杏",this._data[9][5]="北条加蓮",this._data[9][7]="佐久間まゆ",this._data[9][9]="栗原ネネ",this._data[9][10]="ベテラントレーナー",this._data[9][13]="南条光",this._data[9][14]="姫川友紀",this._data[9][16]="神谷奈緒",this._data[9][19]="キャシー・グラハム、アナスタシア",this._data[9][20]="脇山珠美",this._data[9][24]="伊集院惠",this._data[9][26]="冴島清美",this._data[9][28]="佐城雪美",this._data[9][29]="楊菲菲",this._data[10][1]="松永涼",this._data[10][3]="兵藤レナ",this._data[10][6]="乙倉悠貴",this._data[10][9]="浅利七海",this._data[10][10]="椎名法子、我那覇響",this._data[10][11]="服部瞳子",this._data[10][14]="並木芽衣子、藤本里奈",this._data[10][18]="水本ゆかり、小早川紗枝",this._data[10][23]="西川保奈美",this._data[10][26]="上田鈴帆",this._data[10][27]="鷺沢文香",this._data[10][30]="月宮雅",this._data[11][3]="成宮由愛",this._data[11][6]="間中美里",this._data[11][7]="八神マキノ",this._data[11][11]="相川千夏、大石泉",this._data[11][12]="城ヶ崎美嘉",this._data[11][13]="岸部彩華",this._data[11][14]="原田美世",this._data[11][17]="小松伊吹",this._data[11][19]="的場梨沙",this._data[11][22]="篠原礼",this._data[11][23]="星井美希",this._data[11][25]="輿水幸子、川島瑞樹",this._data[12][1]="本田未央",this._data[12][2]="喜多見柚",this._data[12][5]="水野翠",this._data[12][8]="十時愛梨",this._data[12][10]="マスタートレーナー",this._data[12][12]="塩見周子",this._data[12][16]="小日向美穂、大和亜季",this._data[12][18]="横山千佳",this._data[12][24]="イヴ・サンタクロース、萩原雪歩",this._data[12][25]="柊志乃、望月聖",this._data[12][28]="松原早耶",this._data[12][29]="斉藤洋子、真鍋いつき"},Birthday.prototype={_data:[],getToday:function(){var a=new Date,b=a.getMonth()+1,c=a.getDate();return"undefined"==typeof this._data[b][c]?null:this._data[b][c]},getNext:function(){var a=new Date;a.setDate(a.getDate()+1);for(var b=a.getMonth()+1,c=a.getDate();"undefined"==typeof this._data[b][c];)a.setDate(a.getDate()+1),b=a.getMonth()+1,c=a.getDate();return b+"月"+c+"日："+this._data[b][c]}}}();var mobamasDojo=angular.module("mobamasDojo",["ngStorage"]);mobamasDojo.constant("defaultSettings",{visited:{},hidden:{},lastVisited:null,lastTime:Date.now(),infoVersion:-1,showViewSettings:!0,visitedMax:1,autoHide:!0,keepLastVisited:!0,view:{limitTo:10,orderBy:"rankNo",rankRange:{min:0,max:-1},levelRange:{min:0,max:-1},defenseRange:{min:0,max:-1}},dojoLinkUrl:"http://sp.pf.mbga.jp/12008305/?url=http%3A%2F%2F125.6.169.35%2Fidolmaster%2Fprofile%2Fshow%2F",dojoLinkTarget:"_blank",showWelcomeMessage:!0,showBirthday:!1,showMobamasMenu:!1,showMobamasMenuItem:{myPage:!0,petitCg:!1,gacha:!1,cardStr:!1,auction:!1,quests:!1,battles:!1,cardUnion:!1,shop:!1,item:!1,present:!1,cardList:!0,tradeResponse:!1,deck:!1,exchange:!1,cardStorage:!0,rareParts:!1,friend:!1,wish:!1,archive:!1,pRankingAward:!0,results:!1,gallery:!1,memory:!1,sBooth:!1,personalOption:!1,advise:!1,top:!1}}),mobamasDojo.constant("_showToast",function(a,b,c,d,e){var f={message:b,"class":c,timeout:d,callback:e};a.$broadcast("showToast",f)}),mobamasDojo.controller("ToastController",["$scope","$timeout",function(a,b){a.message="";var c=null;a.callback=null;var d=function(){a.message="",null!=c&&(a.callback=null,b.cancel(c),c=null)};a.close=d,a.onclick=function(){a.callback&&a.callback(),d()},a.$on("showToast",function(e,f){d(),a.class=f.class||"",a.message=f.message;var g=f.timeout;null==g&&(g=3e3),a.callback=f.callback||null,g>0&&(c=b(d,g))})}]),mobamasDojo.controller("SettingsController",["$rootScope","$scope","$window","$localStorage","defaultSettings","_showToast",function(a,b,c,d,e,f){var g=f.bind(null,a);b.$storage=d.$default(angular.copy(e)),b.dataOutput=angular.toJson(b.$storage),b.resetVisited=function(){b.$storage.visited={},b.$storage.lastVisited=null,g("訪問回数を初期化しました。")},b.resetHiddenDojos=function(){b.$storage.hidden={},g("道場の非表示設定を初期化しました。")},b.resetAll=function(){b.$storage.$reset(e),g("全ての設定を初期化しました。")},b.inputData=function(){var a=b.dataOutput;if(0===a.length)return void g("データが入力されていません。","error");var c=a.indexOf("{"),d=a.lastIndexOf("}");c>=0&&d>=0&&(a=a.substring(c,d+1));var e=null;try{e=angular.fromJson(a)}catch(f){return void g(f.message,"error",0)}b.$storage.$reset(e),g("データを入力しました。")}}]),mobamasDojo.config(["$httpProvider",function(a){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),mobamasDojo.controller("MainController",["$rootScope","$scope","$http","$localStorage","defaultSettings","_showToast",function(a,b,c,d,e,f){var g=f.bind(null,a),h={HOUR:5,MINUTE:0},i=function(){var a="mobamas-dojo_config",b=angular.copy(e),c=window.localStorage.getItem(a);if(!c)return b;var d=angular.fromJson(c);return Object.keys(d.visited).forEach(function(a){var c=a.replace(/^id/,"");b.visited[c]=d.visited[a]}),Object.keys(d.hide).forEach(function(a){var c=a.replace(/^id/,"");b.hidden[c]=d.hide[a]}),d.lastVisited&&(b.lastVisited=parseInt(d.lastVisited.replace(/^id/,""),10)),b.visitedMax=d.visitedMax,b.autoHide=d.autoHide,b.keepLastVisited=d.keepLastVisited,b.dojoLinkTarget=d.sameTab?"_self":"_blank",b.showBirthday=!d.hideBirthday,b.showMobamasMenu=d.showMobamasMenu,window.localStorage.removeItem(a),b};b.$storage=d.$default(i());var j=function(){var a=new Birthday;b.birthdayToday=a.getToday(),b.birthdayNext=a.getNext()},k=function(){var a=new Date;return a.setHours(h.HOUR),a.setMinutes(h.MINUTE),a.setSeconds(0),a.setMilliseconds(0),a.getTime()>Date.now()&&a.setDate(a.getDate()-1),a.getTime()},l=function(a,b,c){return a>b&&c>=a},m=function(){b.$storage.visited={},b.$storage.lastVisited=null};b.RANK=["F","E","D","C","B","A","S","SS","S3","S4","S5"],b.dojoClass=function(a){var c=0,d={1:["","error"],3:["","success","warning","error"]};return null!=b.$storage.visited[a.id]&&(c=b.$storage.visited[a.id]),c>b.$storage.visitedMax&&(c=b.$storage.visitedMax),d[b.$storage.visitedMax][c]},b.dojoFilter=function(a){if(b.$storage.hidden[a.id])return!1;if(b.$storage.autoHide){var c=null!=b.$storage.visited[a.id]&&b.$storage.visited[a.id]>=b.$storage.visitedMax,d=b.$storage.keepLastVisited&&b.$storage.lastVisited===a.id;if(c&&!d)return!1}var e=b.$storage.view.rankRange.min<=a.rank&&(b.$storage.view.rankRange.max<0||a.rank<=b.$storage.view.rankRange.max),f=b.$storage.view.levelRange.min<=a.lv&&(b.$storage.view.levelRange.max<0||a.lv<=b.$storage.view.levelRange.max),g=!0;return b.$storage.view.defenseRange.min>0&&(g=g&&null!=a.minDefense&&b.$storage.view.defenseRange.min<=a.minDefense),b.$storage.view.defenseRange.max>0&&(g=g&&null!=a.minDefense&&a.minDefense<=b.$storage.view.defenseRange.max),e&&f&&g};var n=function(){c.get("dojos.json").success(function(a){b.lastUpdate=a.lastUpdate,b.dojos=a.dojos,g("エラー: 道場データを取得できませんでした。"+a.lastUpdate+"時点の道場データを使用します。","error",0)}).error(function(){g("エラー: 道場データを取得できませんでした。","error",0)})},o=function(a){b.lastUpdate=a.lastUpdate,b.dojos=a.dojos},p=function(a){var b="dataCache";if(a.dojos&&a.dojos.length>0)o(a),window.localStorage.setItem(b,angular.toJson(a)),g("道場データ読み込み完了！");else{var c=window.localStorage.getItem(b);if(c){var d=angular.fromJson(c);o(d),g("エラー: サーバーから取得した道場データに道場が1件もありませんでした。"+d.lastUpdate+"時点の道場データを使用します。","error",0)}else n()}};b.init=function(){j();var a=Date.now(),d=l(k(),b.$storage.lastTime,a);d&&m(),b.$storage.lastTime=a,g("道場データ読み込み中...");var e="http://mobamas-dojo-server.herokuapp.com/dojos";"localhost"===location.hostname&&(e="http://localhost:4000/dojos"),c.get(e).success(p).error(function(){n()})},b.onClickDojoLink=function(a){var c=function(a,c,d){var e=function(){c?b.$storage.visited[a]=c:delete b.$storage.visited[a],b.$storage.lastVisited=d||null};return e},d=c(a.id,b.$storage.visited[a.id],b.$storage.lastVisited);g("元に戻す: 「"+a.lv+" "+b.RANK[a.rank]+" "+a.leader+"」の訪問","",1e4,d),b.$storage.visited[a.id]?b.$storage.visited[a.id]++:b.$storage.visited[a.id]=1,b.$storage.lastVisited=a.id},b.onClickHideDojo=function(a){var c=function(a,c){var d=function(){c?b.$storage.hidden[a]=c:delete b.$storage.hidden[a]};return d},d=c(a.id,b.$storage.hidden[a.id]);g("元に戻す: 「"+a.lv+" "+b.RANK[a.rank]+" "+a.leader+"」の非表示","",1e4,d),b.$storage.hidden[a.id]=!0}}]);